# ğŸŒ± GreenField Advisor  
**Event-Driven AI Platform for Precision Agriculture**

GreenField Advisor is a **full-stack, event-driven Decision Support System (DSS)** for precision agriculture.  
It combines **IoT telemetry**, **deterministic agronomic rules**, and **Artificial Intelligence (Machine Learning + Deep Learning)** to generate real-time recommendations for:

- ğŸ’§ Irrigation  
- ğŸŒ¿ Fertilization  
- âš¡ Energy / Climate control (HVAC)  
- ğŸ‘ï¸ Crop disease diagnosis (Vision AI)

The platform adopts a **microservices architecture** powered by **Apache Kafka** to ensure **scalability, resilience, and real-time processing**.

---

## ğŸ›ï¸ System Architecture Overview

GreenField Advisor follows an **Event-Driven Microservices Architecture** using **Publish/Subscribe**.

### High-Level Flow
1. **ğŸ“¡ Sensor Producer (`producer_sensor.py`)**
   - Simulates IoT sensors (CSV/realistic random readings, depending on configuration).
   - Publishes raw telemetry to Kafka topic: **`sensor-data`**.

2. **ğŸ§  Analyzer Service (`analyzer.py`) â€” The Brain**
   - Consumes messages from **`sensor-data`**.
   - Runs the **Hybrid Decision Engine**:
     - **Rule-based thresholds** (deterministic)
     - **ML model (Logistic Regression)** (probabilistic)
   - Applies **Observer Pattern** (reacts to anomalies/events inside the processing flow).
   - Publishes a unified recommendation payload to Kafka topic: **`system-advice`**.

3. **ğŸš¨ Notification Service (`notification_consumer.py`)**
   - Consumes from **`system-advice`**.
   - Keeps a buffer of the **last 15 sensor/advice messages**.
   - Detects **combined triggers** (e.g., Irrigation + Energy + Fertilization).
   - Sends a consolidated **email report** using `smtplib`.
   - For local testing, can be used with **`debug_server.py`** (fake SMTP).

4. **ğŸŒ API Gateway / Backend Server (`server.py`)**
   - Flask server acting as the bridge to the **React Frontend**.
   - Exposes endpoints for:
     - **Vision AI Image Upload** (`/upload-image`)
     - **Settings sync** (threshold changes from frontend â†’ backend stream/config)

5. **ğŸ–¥ï¸ Frontend Dashboard (React + TypeScript)**
   - Real-time UI via **Socket.IO**.
   - Displays sensor values, system advice, alerts, and Vision AI diagnosis.
   - Includes pages for Dashboard, Vision, Settings, and Models/Statistics.

---

## ğŸ” Kafka Topics

| Topic Name       | Description |
|-----------------|------------|
| `sensor-data`    | Raw IoT sensor telemetry stream (producer output) |
| `system-advice`  | Unified recommendations generated by `analyzer.py` |

---

## ğŸ§  Hybrid Decision Engine (Dual-Brain)

GreenField Advisor evaluates each incoming sensor message using **two parallel strategies**:

### ğŸ“ Rule-Based Engine (Deterministic)
- Uses agronomic thresholds (human-configurable).
- Safe and explainable.
- Acts as fallback if ML is unavailable.

Example rules:
- Soil moisture < 60% â†’ Irrigation needed  
- Nitrogen < 50 mg/kg â†’ Fertilization needed  
- Temperature < 21Â°C or > 28Â°C OR Humidity > 80% â†’ Energy intervention needed  

### ğŸ¤– ML Engine (Probabilistic)
- **Logistic Regression** trained on historical agronomic data.
- Captures correlations between multiple features.
- Produces an AI decision in parallel to the deterministic engine.

Pipeline includes:
- Data Cleaning  
- Feature Engineering  
- Model Inference  

---

## ğŸ‘ï¸ GreenField Vision AI (Deep Learning Module)

A dedicated **Computer Vision module** performs on-demand crop disease detection.

### Workflow
1. User uploads an image from the frontend (Vision page).
2. Image is sent to backend via **`/upload-image`**.
3. Image is preprocessed (224Ã—224 + normalization).
4. CNN model predicts class + confidence.
5. Backend enriches output with advisory information (severity, actions, prevention).

### Model Details
- Architecture: **MobileNetV2 (Transfer Learning)**
- Framework: **TensorFlow / Keras**
- Total Classes: **44**
- Dataset: PlantVillage + custom agricultural classes

### Safety Logic
- Confidence < 35% â†’ â€œUncertain Analysisâ€
- Background/Noise detection supported

---

## ğŸ› ï¸ Technology Stack

### Backend
- Python, Flask
- Pandas, NumPy
- Scikit-Learn (Logistic Regression)
- TensorFlow / Keras (Vision AI)
- Apache Kafka + Zookeeper
- Socket.IO (real-time UI bridge)
- SMTP (notifications)

### Frontend
- React 18, TypeScript
- Vite
- Material UI
- Socket.IO Client

### Auth Microservice
- Node.js, Express
- SQLite
- JWT, Bcrypt

### Infrastructure
- Docker, Docker Compose

---

## ğŸ“‚ Project Structure

progetto-greenfield-advisor/
â”‚
â”œâ”€â”€ backend/
â”‚ â”œâ”€â”€ producer_sensor.py
â”‚ â”œâ”€â”€ analyzer.py
â”‚ â”œâ”€â”€ notification_consumer.py
â”‚ â”œâ”€â”€ debug_server.py
â”‚ â”œâ”€â”€ server.py
â”‚ â”œâ”€â”€ observers.py
â”‚ â”œâ”€â”€ pipeline.py
â”‚ â”œâ”€â”€ data_loader.py
â”‚ â”œâ”€â”€ strategies_model.py
â”‚ â”œâ”€â”€ strategies_vision.py
â”‚ â”œâ”€â”€ train_agri_model.py
â”‚ â”œâ”€â”€ greenfield_agri_brain.h5
â”‚ â”œâ”€â”€ class_indices.json
â”‚ â””â”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ greenfield-dashboard/
|   |   â”œâ”€â”€.env
|   |   â”œâ”€â”€ node modules
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â””â”€â”€ Profilation/
â”‚       â”œâ”€â”€ src/
â”‚       â”œâ”€â”€ data.sqlite
â”‚       â”œâ”€â”€ .env
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ package-lock.json
|       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ tsconfig.json
â”‚
â””â”€â”€ README.md


## â–¶ï¸ How to Run the Project (Local)

### ğŸ“‹ Prerequisites
Ensure you have the following installed on your machine:
- **Docker & Docker Compose** (for Kafka and Zookeeper)
- **Python 3.9+** (for Backend Microservices)
- **Node.js 16+ & npm** (for Frontend and Auth Service)

### 1ï¸âƒ£ Start Kafka (Docker)
From the folder containing `docker-compose.yml`:

```bash
docker compose up -d
```

### 2ï¸âƒ£ (Optional) Start Fake SMTP for Local Email Testing
```bash
python debug_server.py
```

### 3ï¸âƒ£ Start Analyzer Service (Core Brain)
```bash
python analyzer.py
```

### 4ï¸âƒ£ Start Notification Consumer (Email Alerts)
```bash
python notification_consumer.py
```

### 5ï¸âƒ£ Start Backend API Gateway (Flask)
```bash
python server.py
```

### 6ï¸âƒ£ Start Sensor Producer
```bash
python producer_sensor.py
```

### 7ï¸âƒ£ Start Frontend (React)
```bash
cd frontend/greenfield-dashboard
npm install
npm run dev
```

### 8ï¸âƒ£ Start Auth Microservice (Profilation)
```bash
cd frontend/Profilation
npm install
npm run dev
```

## Key Features
- Real-time IoT data streaming (Kafka)
- Event-driven microservices (Pub/Sub)
- Hybrid decision engine: Rule-based + ML
- Observer Pattern reaction flow inside backend logic
- Unified advice stream (system-advice)
- Smart notifications (buffer last 15, grouped alerts, email reports)
- Live dashboard updates (Socket.IO)
- Vision AI (CNN) disease detection from image upload
- Secure authentication service (JWT + SQLite)

## Educational Focus
- This project demonstrates:
- Event-Driven Architecture
- Observer Pattern (Kafka-based + internal observers)
- Microservices Design
- Producer/Consumer messaging
- AI + Rule-Based hybrid systems
- Real-time frontend/backend communication
- Secure separation of concerns (Auth microservice)
- Designed for Software Architecture, Distributed Systems, and AI Engineering courses.

## Final Note
- GreenField Advisor is built with robustness, transparency, and safety in mind â€” ensuring that AI enhances human decision-making without replacing agronomic expertise.